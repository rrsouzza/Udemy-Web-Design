<!doctype html>
<html>
    <head>
        <!--
            PROBLEMA: Em uma página long scrolling de navegação interna, identificar(destacar) no menu principal (fixo no topo da página) a seção atual enquanto o  usuário scrolla a página.
        -->
        <title>Javascript - Problema</title>
        <meta charset="utf-8">
        <style type="text/css">
            body{
                font: 100%/2 sans-serif;
            }
            .nav{
                position: fixed;
                width: 150px;
                top: 25px;
                left: 10px;
                border: 1px solid #ccc;
            }
            .content{
                margin-left: 165px;
            }
            .nav ul{
                margin: 0;
                padding: 0;
                list-style: none;
            }
            .nav li{
                background: #ddd;
                
            }
            .nav li + li{
                margin-top: 2px;
            }
            .nav a{
                display: block;
                padding: 10px;
            }
            .nav a.active{
                background: orange;
            }
	    </style>
    </head>
    <body>
        <nav class="nav">
            <ul>
                <li><a href="#s1">link 1</a></li>
                <li><a href="#s2">link 2</a></li>
                <li><a href="#s3">link 3</a></li>
            </ul>
        </nav>

        <main class="content">
            <h1>Javascript - Problema</h1>

            <h2 id="s1">secao 1</h2>
            
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Sint fuga, deleniti repellat iure cum autem excepturi saepe totam quam, nam expedita aspernatur tenetur tempora, cupiditate. Sapiente cumque saepe maiores a.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            
            <h2 id="s2">secao 2</h2>

            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Sint fuga, deleniti repellat iure cum autem excepturi saepe totam quam, nam expedita aspernatur tenetur tempora, cupiditate. Sapiente cumque saepe maiores a.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            
            <h2 id="s3">secao 3</h2>
            
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Sint fuga, deleniti repellat iure cum autem excepturi saepe totam quam, nam expedita aspernatur tenetur tempora, cupiditate. Sapiente cumque saepe maiores a.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolore autem aspernatur fugiat necessitatibus deleniti ea earum expedita exercitationem soluta unde suscipit saepe deserunt, illo est perferendis, at natus. Ducimus, voluptate!</p>
        </main>

        <script>

            (function(){
                window.addEventListener('scroll', destacaMenu);
                var $menu = document.querySelector('.nav');
                var $links = $menu.querySelectorAll('li a');

                function destacaMenu(){
                    var positions = [];
                    for (var i = 0; i < $links.length; i++){
                        positions[i] = pegaYPosicaoScroll($links[i])
                    }
                    console.log(positions);

                    var linkAtual = pegaUltimoLinkVisivel(positions);
                    
                    var linkActive = $menu.querySelector('.active');
                    if (linkActive) linkActive.classList.remove('active');

                    linkAtual.classList.add('active');
                }

                function pegaYPosicaoScroll(link){
                    var alvo = document.querySelector(link.getAttribute('href'));
                    var positionYViewport = alvo.getBoundingClientRect().top;
                    return positionYViewport;
                }

                function pegaUltimoLinkVisivel(positions){
                    var qtd = positions.length;
                    while(qtd){
                        qtd--;
                        if (positions[qtd] < innerHeight / 2){  //Assim ele já troca o destaque quando estiver na metade da seção
                            return $links[qtd];
                        }
                    }
                    return $links[0];
                }
            })()
        </script>
    </body>
</html>